<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Dashboard â€“ Cuambe English School</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Inter', sans-serif; }
  table { border-collapse: collapse; width: 100%; }
  th, td { padding: 0.75rem; text-align: left; white-space: nowrap; }
  th { background-color: rgba(59, 130, 246, 0.2); }
  tr:nth-child(even) { background-color: rgba(59, 130, 246, 0.1); }
  @media (max-width: 768px) {
    table, thead, tbody, th, td, tr {
      display: block;
    }
    thead tr { display: none; }
    td {
      position: relative;
      padding-left: 50%;
      text-align: right;
      border-bottom: 1px solid #ddd;
    }
    td::before {
      content: attr(data-label);
      position: absolute;
      left: 0;
      width: 50%;
      padding-left: 1rem;
      font-weight: bold;
      text-align: left;
    }
  }
</style>
</head>

<body class="bg-gradient-to-r from-blue-800 via-red-600 to-yellow-500 min-h-screen flex flex-col md:flex-row">

<!-- Mobile Header -->
<header class="md:hidden bg-blue-900 text-white flex justify-between items-center px-4 py-3">
  <h1 class="text-xl font-bold">Admin Dashboard</h1>
  <button id="menuToggle" class="text-2xl">â˜°</button>
</header>

<!-- Sidebar -->
<aside id="sidebar" class="w-72 bg-gradient-to-b from-blue-900 to-blue-700 text-white flex flex-col shadow-lg p-4 space-y-4 md:static absolute inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
  <h1 class="text-2xl font-bold text-center mb-6 hidden md:block">Admin Dashboard</h1>

  <button onclick="showSection('welcome')" class="nav-btn">
    ğŸ  Welcome
  </button>
  <button onclick="showSection('teachers')" class="nav-btn">
    ğŸ‘©â€ğŸ« Teachers
  </button>
  <button onclick="showSection('students')" class="nav-btn">
    ğŸ‘¨â€ğŸ“ Students
  </button>
  <button onclick="showSection('settings')" class="nav-btn">
    âš™ï¸ Settings
  </button>
  <button onclick="logout()" class="bg-red-600 hover:bg-red-700 font-bold flex items-center gap-2 justify-center px-4 py-3 rounded-xl mt-auto">
    ğŸšª Logout
  </button>
</aside>

<!-- Main Content -->
<main class="flex-1 p-4 md:p-8 space-y-8 overflow-y-auto">

  <!-- Welcome Section -->
  <section id="welcome" class="space-y-6">
    <h2 class="text-3xl font-bold text-white">ğŸŒŸ Welcome, Administrator!</h2>
    <div class="bg-white/95 p-6 md:p-8 rounded-2xl shadow-lg text-gray-800 space-y-6">
      <p class="text-lg leading-relaxed">
        Welcome to the <strong>Cuambe English School Administration Panel</strong>, the control center where your leadership and dedication shape the success of both teachers and students.
      </p>

      <p class="text-lg leading-relaxed">
        Every click here builds a bridge between knowledge and achievement. Your role inspires both learning and excellence.
      </p>

      <p class="text-lg leading-relaxed">
        As an administrator, you oversee systems that connect dreams with opportunities. Lead with integrity, and let your actions reflect Cuambe English Schoolâ€™s excellence.
      </p>

      <p class="text-lg italic text-gray-700 border-l-4 border-blue-600 pl-4">
        ğŸ’¡ <strong>Tip:</strong> Use this dashboard not just to manage, but to uplift livesâ€”one lesson at a time.
      </p>

      <!-- Admin of the Month + Quote -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <div class="bg-gradient-to-br from-yellow-400 to-orange-500 p-6 rounded-2xl text-white shadow-lg">
          <h3 class="text-xl font-bold mb-2">ğŸ† Admin of the Month</h3>
          <p class="text-lg font-semibold">Felisberto Raimundo Cuambe</p>
          <p class="text-sm opacity-90 mt-2">Recognized for leadership, innovation, and dedication to academic excellence.</p>
        </div>

        <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-6 rounded-2xl text-white shadow-lg">
          <h3 class="text-xl font-bold mb-2">ğŸ’¬ Motivational Quote</h3>
          <p id="quote" class="text-lg italic"></p>
        </div>
      </div>
    </div>
  </section>

  <!-- Teachers Section -->
  <section id="teachers" class="hidden space-y-6">
    <h2 class="text-2xl font-semibold text-white">ğŸ‘©â€ğŸ« Manage Teachers</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800 overflow-x-auto">
      <table id="teachersTable">
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Level</th><th>ID</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Students Section -->
  <section id="students" class="hidden space-y-6">
    <h2 class="text-2xl font-semibold text-white">ğŸ‘¨â€ğŸ“ Manage Students</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800 overflow-x-auto">
      <table id="studentsTable">
        <thead>
          <tr>
            <th>Name</th><th>Email</th><th>Level</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Settings Section -->
  <section id="settings" class="hidden space-y-6">
    <h2 class="text-2xl font-semibold text-white">âš™ï¸ Admin Settings</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800 space-y-4">
      <div>
        <label class="block font-semibold text-gray-700">Current Email</label>
        <input type="email" id="currentEmail" class="w-full border rounded px-3 py-2" />
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Current Password</label>
        <input type="password" id="currentPassword" class="w-full border rounded px-3 py-2" />
      </div>
      <div>
        <label class="block font-semibold text-gray-700">New Password</label>
        <input type="password" id="newPassword" class="w-full border rounded px-3 py-2" />
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Confirm New Password</label>
        <input type="password" id="confirmPassword" class="w-full border rounded px-3 py-2" />
      </div>
      <button onclick="saveAdminSettings()" class="bg-blue-700 hover:bg-blue-600 text-white font-semibold px-6 py-2 rounded-xl mt-2">Save Changes</button>
    </div>
  </section>
</main>

<script>
// Sidebar toggle (for mobile)
const sidebar = document.getElementById("sidebar");
const menuToggle = document.getElementById("menuToggle");
if (menuToggle) {
  menuToggle.addEventListener("click", () => {
    sidebar.classList.toggle("-translate-x-full");
  });
}

// Admin access control
const loggedAdmin = JSON.parse(localStorage.getItem('loggedAdmin'));
if (!loggedAdmin) {
  alert('Access denied. Only admins can access this page.');
  window.location.href = '../login.html';
}

// Navigation
function showSection(section) {
  document.querySelectorAll('main section').forEach(sec => sec.classList.add('hidden'));
  document.getElementById(section).classList.remove('hidden');
  sidebar.classList.add('-translate-x-full'); // auto-close menu on mobile
}

// Logout
function logout() {
  localStorage.removeItem('loggedAdmin');
  window.location.href = '../login.html';
}

// Load teachers
function loadTeachers() {
  const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
  const tbody = document.querySelector('#teachersTable tbody');
  tbody.innerHTML = '';
  teachers.forEach((t, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Name">${t.name}</td>
      <td data-label="Email">${t.email}</td>
      <td data-label="Level">${t.level || ''}</td>
      <td data-label="ID">${t.id || ''}</td>
      <td data-label="Actions" class="space-x-2">
        <button onclick="editTeacher(${idx})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
        <button onclick="deleteTeacher(${idx})" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
        <button onclick="goTeacherDashboard('${t.email}')" class="bg-blue-700 text-white px-2 py-1 rounded">Dashboard</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// Load students
function loadStudents() {
  const students = JSON.parse(localStorage.getItem('students') || '[]');
  const tbody = document.querySelector('#studentsTable tbody');
  tbody.innerHTML = '';
  students.forEach((s, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td data-label="Name">${s.name}</td>
      <td data-label="Email">${s.email}</td>
      <td data-label="Level">${s.level || ''}</td>
      <td data-label="Actions" class="space-x-2">
        <button onclick="editStudent(${idx})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
        <button onclick="deleteStudent(${idx})" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
        <button onclick="goStudentDashboard('${s.email}')" class="bg-blue-700 text-white px-2 py-1 rounded">Dashboard</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// Delete entries
function deleteTeacher(idx) {
  if (confirm('Delete this teacher?')) {
    const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
    teachers.splice(idx,1);
    localStorage.setItem('teachers', JSON.stringify(teachers));
    loadTeachers();
  }
}

function deleteStudent(idx) {
  if (confirm('Delete this student?')) {
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    students.splice(idx,1);
    localStorage.setItem('students', JSON.stringify(students));
    loadStudents();
  }
}

// Redirects
function goTeacherDashboard(email) {
  localStorage.setItem('loggedTeacher', JSON.stringify({email}));
  window.location.href = '../teachers/teachersdashboard.html';
}

function goStudentDashboard(email) {
  localStorage.setItem('loggedStudent', JSON.stringify({email}));
  window.location.href = '../students/studentdashboard.html';
}

// Hash + save settings
async function hashPassword(password) {
  const enc = new TextEncoder();
  const data = enc.encode(password);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

async function saveAdminSettings() {
  const currentEmail = document.getElementById('currentEmail').value;
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if (newPassword !== confirmPassword) return alert('New passwords do not match.');

  let admins = JSON.parse(localStorage.getItem('admins') || '[]');
  const adminIdx = admins.findIndex(a => a.email === loggedAdmin.email);
  if (adminIdx === -1) return alert('Admin not found.');

  const hashedCurrent = await hashPassword(currentPassword);
  if (hashedCurrent !== admins[adminIdx].passwordHash) return alert('Current password incorrect.');

  admins[adminIdx].email = currentEmail || admins[adminIdx].email;
  if (newPassword) admins[adminIdx].passwordHash = await hashPassword(newPassword);

  localStorage.setItem('admins', JSON.stringify(admins));
  alert('Admin settings updated.');
  loadAdminSettings();
}

function loadAdminSettings() {
  document.getElementById('currentEmail').value = loggedAdmin.email;
}

// Random quote
const quotes = [
  "Education is the most powerful weapon you can use to change the world. â€“ Nelson Mandela",
  "Leadership is influence, nothing more, nothing less. â€“ John C. Maxwell",
  "A good teacher inspires hope and love for learning. â€“ Brad Henry",
  "The future belongs to those who believe in the beauty of their dreams. â€“ Eleanor Roosevelt",
  "Success is not the key to happiness; happiness is the key to success."
];
document.getElementById('quote').innerText = quotes[Math.floor(Math.random() * quotes.length)];

window.onload = function() {
  loadTeachers();
  loadStudents();
  loadAdminSettings();
};
</script>

</body>
</html>
