<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard – Cuambe English School</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { font-family: 'Inter', sans-serif; }
  table { border-collapse: collapse; width: 100%; }
  th, td { padding: 0.75rem; text-align: left; }
  th { background-color: rgba(59, 130, 246, 0.2); }
  tr:nth-child(even) { background-color: rgba(59, 130, 246, 0.1); }
</style>
</head>

<body class="bg-gradient-to-r from-blue-800 via-red-600 to-yellow-500 min-h-screen flex">

<!-- Sidebar -->
<aside class="w-72 bg-gradient-to-b from-blue-900 to-blue-700 text-white flex flex-col shadow-lg p-4 space-y-4">
  <h1 class="text-2xl font-bold text-center mb-6">Admin Dashboard</h1>

  <button onclick="showSection('welcome')" class="w-full px-4 py-3 rounded-xl bg-blue-800 hover:bg-blue-600 font-semibold flex items-center gap-2 justify-center">
    🏠 Welcome
  </button>

  <button onclick="showSection('teachers')" class="w-full px-4 py-3 rounded-xl bg-blue-800 hover:bg-blue-600 font-semibold flex items-center gap-2 justify-center">
    👩‍🏫 Teachers
  </button>

  <button onclick="showSection('students')" class="w-full px-4 py-3 rounded-xl bg-blue-800 hover:bg-blue-600 font-semibold flex items-center gap-2 justify-center">
    👨‍🎓 Students
  </button>

  <button onclick="showSection('settings')" class="w-full px-4 py-3 rounded-xl bg-blue-800 hover:bg-blue-600 font-semibold flex items-center gap-2 justify-center">
    ⚙️ Settings
  </button>

  <button onclick="logout()" class="w-full px-4 py-3 rounded-xl bg-red-600 hover:bg-red-700 font-bold flex items-center gap-2 justify-center mt-auto">
    🚪 Logout
  </button>
</aside>

<!-- Main Content -->
<main class="flex-1 p-8 space-y-8 overflow-y-auto">

  <!-- Welcome Section -->
  <section id="welcome" class="space-y-6">
    <h2 class="text-3xl font-bold text-white">🌟 Welcome, Administrator!</h2>
    <div class="bg-white/95 p-8 rounded-2xl shadow-lg text-gray-800 space-y-6">
      <p class="text-lg leading-relaxed">
        Welcome to the <strong>Cuambe English School Administration Panel</strong>, the control center where your leadership, vision, and dedication shape the success of both teachers and students. This is more than a dashboard; it’s a gateway to empowering communication, fostering learning excellence, and driving a brighter academic future.
      </p>

      <p class="text-lg leading-relaxed">
        Every click you make here builds a bridge between knowledge and achievement. Your ability to manage and support our teachers and students ensures that English learning continues with passion, precision, and purpose. Remember, your role is not only to lead but also to inspire those who are walking the path of education.
      </p>

      <p class="text-lg leading-relaxed">
        As an administrator, you hold the keys to quality, discipline, and progress. You oversee the systems that connect dreams with opportunities where every student gains confidence to speak, and every teacher finds strength to teach. Lead with integrity, and let your actions reflect the excellence that Cuambe English School stands for.
      </p>

      <p class="text-lg italic text-gray-700 border-l-4 border-blue-600 pl-4">
        💡 <strong>Tip:</strong> Use this dashboard not just to manage, but to uplift. When you update a record, guide a teacher, or welcome a student, remember you are shaping lives, one lesson at a time.
      </p>

      <!-- Admin of the Month + Quote -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
        <div class="bg-gradient-to-br from-yellow-400 to-orange-500 p-6 rounded-2xl text-white shadow-lg">
          <h3 class="text-xl font-bold mb-2">🏆 Admin of the Month</h3>
          <p class="text-lg font-semibold">Felisberto Raimundo Cuambe</p>
          <p class="text-sm opacity-90 mt-2">Recognized for exceptional leadership, innovation, and unwavering dedication to academic excellence.</p>
        </div>

        <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-6 rounded-2xl text-white shadow-lg">
          <h3 class="text-xl font-bold mb-2">💬 Motivational Quote</h3>
          <p id="quote" class="text-lg italic"></p>
        </div>
      </div>
    </div>
  </section>

  <!-- Teachers Section -->
  <section id="teachers" class="hidden space-y-6">
    <h2 class="text-2xl font-semibold text-white mb-4">👩‍🏫 Manage Teachers</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800">
      <table id="teachersTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Level</th>
            <th>ID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Students Section -->
  <section id="students" class="hidden space-y-6">
    <h2 class="text-2xl font-semibold text-white mb-4">👨‍🎓 Manage Students</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800">
      <table id="studentsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Level</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Settings Section -->
  <section id="settings" class="hidden space-y-4">
    <h2 class="text-2xl font-semibold text-white mb-4">⚙️ Admin Settings</h2>
    <div class="bg-white/90 p-6 rounded-2xl shadow text-gray-800 space-y-4">
      <div>
        <label class="block font-semibold text-gray-700">Current Email</label>
        <input type="email" id="currentEmail" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Current Password</label>
        <input type="password" id="currentPassword" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">New Password</label>
        <input type="password" id="newPassword" class="w-full border rounded px-3 py-2">
      </div>
      <div>
        <label class="block font-semibold text-gray-700">Confirm New Password</label>
        <input type="password" id="confirmPassword" class="w-full border rounded px-3 py-2">
      </div>
      <button onclick="saveAdminSettings()" class="bg-blue-700 hover:bg-blue-600 text-white font-semibold px-6 py-2 rounded-xl mt-2">Save Changes</button>
    </div>
  </section>

</main>

<script>
// Admin access control
const loggedAdmin = JSON.parse(localStorage.getItem('loggedAdmin'));
if (!loggedAdmin) {
  alert('Access denied. Only admins can access this page.');
  window.location.href = '../login.html';
}

// Navigation
function showSection(section) {
  document.querySelectorAll('main section').forEach(sec => sec.classList.add('hidden'));
  document.getElementById(section).classList.remove('hidden');
}

// Logout
function logout() {
  localStorage.removeItem('loggedAdmin');
  window.location.href = '../login.html';
}

// Populate teachers
function loadTeachers() {
  const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
  const tbody = document.querySelector('#teachersTable tbody');
  tbody.innerHTML = '';
  teachers.forEach((t, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${t.name}</td>
      <td>${t.email}</td>
      <td>${t.level || ''}</td>
      <td>${t.id || ''}</td>
      <td class="space-x-2">
        <button onclick="editTeacher(${idx})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
        <button onclick="deleteTeacher(${idx})" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
        <button onclick="goTeacherDashboard('${t.email}')" class="bg-blue-700 text-white px-2 py-1 rounded">Dashboard</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// Populate students
function loadStudents() {
  const students = JSON.parse(localStorage.getItem('students') || '[]');
  const tbody = document.querySelector('#studentsTable tbody');
  tbody.innerHTML = '';
  students.forEach((s, idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${s.name}</td>
      <td>${s.email}</td>
      <td>${s.level || ''}</td>
      <td class="space-x-2">
        <button onclick="editStudent(${idx})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
        <button onclick="deleteStudent(${idx})" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
        <button onclick="goStudentDashboard('${s.email}')" class="bg-blue-700 text-white px-2 py-1 rounded">Dashboard</button>
      </td>`;
    tbody.appendChild(tr);
  });
}

// Edit & Delete
function deleteTeacher(idx) {
  if (confirm('Delete this teacher?')) {
    const teachers = JSON.parse(localStorage.getItem('teachers') || '[]');
    teachers.splice(idx,1);
    localStorage.setItem('teachers', JSON.stringify(teachers));
    loadTeachers();
  }
}

function deleteStudent(idx) {
  if (confirm('Delete this student?')) {
    const students = JSON.parse(localStorage.getItem('students') || '[]');
    students.splice(idx,1);
    localStorage.setItem('students', JSON.stringify(students));
    loadStudents();
  }
}

// Redirect
function goTeacherDashboard(email) {
  localStorage.setItem('loggedTeacher', JSON.stringify({email}));
  window.location.href = '../teachers/teachersdashboard.html';
}

function goStudentDashboard(email) {
  localStorage.setItem('loggedStudent', JSON.stringify({email}));
  window.location.href = '../students/studentdashboard.html';
}

// Admin settings update
async function hashPassword(password) {
  const enc = new TextEncoder();
  const data = enc.encode(password);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
}

async function saveAdminSettings() {
  const currentEmail = document.getElementById('currentEmail').value;
  const currentPassword = document.getElementById('currentPassword').value;
  const newPassword = document.getElementById('newPassword').value;
  const confirmPassword = document.getElementById('confirmPassword').value;

  if(newPassword !== confirmPassword){
    alert('New passwords do not match.');
    return;
  }

  let admins = JSON.parse(localStorage.getItem('admins') || '[]');
  const adminIdx = admins.findIndex(a => a.email === loggedAdmin.email);
  if(adminIdx === -1){
    alert('Admin not found.');
    return;
  }

  const hashedCurrent = await hashPassword(currentPassword);
  if(hashedCurrent !== admins[adminIdx].passwordHash){
    alert('Current password incorrect.');
    return;
  }

  admins[adminIdx].email = currentEmail || admins[adminIdx].email;
  if(newPassword){
    admins[adminIdx].passwordHash = await hashPassword(newPassword);
  }

  localStorage.setItem('admins', JSON.stringify(admins));
  alert('Admin settings updated.');
  loadAdminSettings();
}

function loadAdminSettings(){
  document.getElementById('currentEmail').value = loggedAdmin.email;
}

// Motivational Quotes
const quotes = [
  "Education is the most powerful weapon you can use to change the world. – Nelson Mandela",
  "Leadership is not about titles, positions, or flowcharts. It’s about one life influencing another. – John C. Maxwell",
  "A good teacher can inspire hope, ignite the imagination, and instill a love of learning. – Brad Henry",
  "The future belongs to those who believe in the beauty of their dreams. – Eleanor Roosevelt",
  "Success is not the key to happiness. Happiness is the key to success."
];
document.getElementById('quote').innerText = quotes[Math.floor(Math.random() * quotes.length)];

window.onload = function() {
  loadTeachers();
  loadStudents();
  loadAdminSettings();
};
</script>

</body>
</html>
